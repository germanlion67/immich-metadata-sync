version: '3.8'

services:
  immich-metadata-sync:
    image: python:3.11-slim
    container_name: immich-metadata-sync-test
    volumes:
      - /home/immich/immich-library/library:/app/library
      - ./logs:/app/logs
    # Falls du keine stack.env hast, kommentiere die nächste Zeile mit # aus
    # env_file:
    #   - stack.env
    command: |
      sh -c "
      apt-get update && apt-get install -y exiftool curl
      pip install --no-cache-dir requests tqdm
      mkdir -p /app
      curl -L -o /app/script.py https://raw.githubusercontent.com/germanlion67/immich-metadata-sync/main/script/immich-ultra-sync.py
      sed -i \"s/startswith('\\\\')/startswith('\\\\\\\\')/g\" /app/script.py
      python /app/script.py --all
      echo 'Fertig. Halte Container offen für Portainer-Logs.'
      sleep infinity
      "
